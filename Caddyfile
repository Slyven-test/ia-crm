{
  auto_https off
}

:80 {
  encode zstd gzip

  header {
    Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
  }

  @api path /api/* /health /docs /openapi.json /redoc
  handle @api {
    reverse_proxy backend:8000 {
      header_up Host {http.request.host}
      header_up X-Forwarded-Host {http.request.host}
      header_up X-Forwarded-Proto {http.request.header.X-Forwarded-Proto}
    }
  }

  handle {
    reverse_proxy frontend:80
  }
}
